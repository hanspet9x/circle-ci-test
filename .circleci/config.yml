version: 2.1

commands:
  build:
    parameters:
      stage:
        type: string
        default: development
    steps:
      - run: |
          NODE_ENV=<< parameters.stage >>
           scp -rpC madem/* circleci@46.101.26.184:~/livestock/madem
jobs:
  hello:
    docker:
      - image: cimg/base:2023.02
    steps:
      - checkout
      - add_ssh_keys:
          fingerprints:
            - "df:3d:1d:10:98:70:9f:39:7f:fb:00:38:21:eb:e9:1f"
      - build:
          stage: << pipeline.git.branch >>
      - run: |
         echo << pipeline.git.branch >>
         echo hello world;
         echo $POSID;
         echo $POSI

workflows:
  workflow1:
    jobs:

      - hello:
          context:
            - circeci-test